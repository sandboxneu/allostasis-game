{"ast":null,"code":"import _classCallCheck from \"/Users/yashshetty/Desktop/Sandbox/allostasis-game/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/yashshetty/Desktop/Sandbox/allostasis-game/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/yashshetty/Desktop/Sandbox/allostasis-game/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/yashshetty/Desktop/Sandbox/allostasis-game/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/yashshetty/Desktop/Sandbox/allostasis-game/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/yashshetty/Desktop/Sandbox/allostasis-game/src/GameController.js\";\nimport React, { Component } from 'react';\nimport Grid from './Grid/Grid.js';\nimport ConfigurableValuesController from './ConfigurableValuesController.js';\nimport GlobalConstants from './GlobalConstants.js';\nimport LifeBarController from './LifeBars/LifeBarController.js';\nimport ServerUtils from './ServerUtils';\nimport \"./GameController.css\";\nvar ENTER_KEY = 13;\nvar LEFT_KEY = 37;\nvar UP_KEY = 38;\nvar RIGHT_KEY = 39;\nvar DOWN_KEY = 40;\nvar GRID_LENGTH = ConfigurableValuesController.getGridRowLength();\n\nvar GameController =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(GameController, _Component);\n\n  function GameController() {\n    var _this;\n\n    _classCallCheck(this, GameController);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(GameController).call(this));\n\n    _this._handleKeyDown = function (event) {\n      switch (event.keyCode) {\n        case ENTER_KEY:\n          console.log(\"ENTER\");\n          break;\n\n        case LEFT_KEY:\n          _this._handlePlayerMovement(-1, 0);\n\n          break;\n\n        case UP_KEY:\n          _this._handlePlayerMovement(0, -1);\n\n          break;\n\n        case RIGHT_KEY:\n          _this._handlePlayerMovement(1, 0);\n\n          break;\n\n        case DOWN_KEY:\n          _this._handlePlayerMovement(0, 1);\n\n          break;\n\n        default:\n          break;\n      }\n    };\n\n    _this.hasSentData = false;\n    _this.curThirst = ConfigurableValuesController.getInitialThirst();\n    _this.curHunger = ConfigurableValuesController.getInitialHunger();\n    _this.curLoad = ConfigurableValuesController.getInitialLoad();\n    _this.hungerLowerBound = ConfigurableValuesController.getHungerLowerBound();\n    _this.hungerUpperBound = ConfigurableValuesController.getHungerUpperBound();\n    _this.thirstLowerBound = ConfigurableValuesController.getThirstLowerBound();\n    _this.thirstUpperBound = ConfigurableValuesController.getThirstUpperBound();\n    _this.tick = 0;\n    _this.state = {\n      entities: _this._generateEntities(),\n      playerXPos: ConfigurableValuesController.getInitialXPos(),\n      playerYPos: ConfigurableValuesController.getInitialYPos(),\n      hunger: _this.curHunger,\n      thirst: _this.curThirst,\n      load: _this.curLoad\n    };\n    return _this;\n  }\n\n  _createClass(GameController, [{\n    key: \"_generateEntities\",\n    value: function _generateEntities() {\n      var entities = [];\n\n      this._placeEntity(entities, ConfigurableValuesController.getEntityDataWater1());\n\n      this._placeEntity(entities, ConfigurableValuesController.getEntityDataWater2());\n\n      this._placeEntity(entities, ConfigurableValuesController.getEntityDataFood1());\n\n      this._placeEntity(entities, ConfigurableValuesController.getEntityDataFood2());\n\n      return entities;\n    } // Creates a new entity with the specified data and random coordinates,\n    // placing it into the array `entities`\n\n  }, {\n    key: \"_placeEntity\",\n    value: function _placeEntity(entities, new_entity_data) {\n      var random_coord = function random_coord() {\n        return Math.max(Math.min(Math.round(Math.random() * GRID_LENGTH), GRID_LENGTH - 1), 0);\n      };\n\n      var no_placement_conflict = function no_placement_conflict(entity) {\n        return x !== entity.x && y !== entity.y;\n      };\n\n      do {\n        var x = random_coord();\n        var y = random_coord();\n        entities.push({\n          x: x,\n          y: y,\n          data: new_entity_data\n        });\n      } while (entities.every(no_placement_conflict));\n    }\n  }, {\n    key: \"componentWillMount\",\n    value: function componentWillMount() {\n      document.addEventListener(\"keydown\", this._handleKeyDown.bind(this));\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      document.removeEventListener(\"keydown\", this._handleKeyDown.bind(this));\n    }\n  }, {\n    key: \"_adjustThirst\",\n    value: function _adjustThirst(num) {\n      var temp = this.curThirst;\n      temp += num;\n\n      if (temp >= 0) {\n        if (temp > 100) {\n          this.curThirst = 100;\n        } else {\n          this.curThirst = temp;\n        }\n      } else {\n        this.curThirst = 0;\n      }\n    }\n  }, {\n    key: \"_adjustHunger\",\n    value: function _adjustHunger(num) {\n      var temp = this.curHunger;\n      temp += num;\n\n      if (temp >= 0) {\n        if (temp > 100) {\n          this.curHunger = 100;\n        } else {\n          this.curHunger = temp;\n        }\n      } else {\n        this.curHunger = 0;\n      }\n    }\n  }, {\n    key: \"_adjustLoad\",\n    value: function _adjustLoad(num) {\n      var temp = this.curLoad;\n      temp += num;\n\n      if (temp >= 0) {\n        if (temp > 100) {\n          this.curLoad = 100;\n        } else {\n          this.curLoad = temp;\n        }\n      } else {\n        this.curLoad = 0;\n      }\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.interval = setInterval(this.tick, 1000);\n    }\n  }, {\n    key: \"tick\",\n    value: function tick() {\n      this.setState({\n        tick: this.state.tick + 1\n      });\n    }\n  }, {\n    key: \"_handlePlayerMovement\",\n    value: function _handlePlayerMovement(xMov, yMov) {\n      var curX = this.state.playerXPos;\n      var curY = this.state.playerYPos;\n      curX += xMov;\n      curY += yMov;\n\n      if (curX >= 0 && curX < ConfigurableValuesController.getGridRowLength() && curY >= 0 && curY < ConfigurableValuesController.getGridRowLength()) {\n        var entitiesHere = this.state.entities.filter(function (e) {\n          return e.x === curX && e.y === curY;\n        });\n        var entityRewards = entitiesHere.reduce(function (total, e) {\n          var rewards = e.data.reward_fn();\n          return {\n            food: total.food + rewards.food,\n            water: total.water + rewards.water\n          };\n        }, {\n          food: ConfigurableValuesController.getMovementHungerDecay(),\n          water: ConfigurableValuesController.getMovementThirstDecay()\n        });\n\n        this._adjustThirst(entityRewards.water);\n\n        this._adjustHunger(entityRewards.food);\n\n        this._adjustLoad(1);\n\n        this.setState({\n          playerXPos: curX,\n          playerYPos: curY,\n          thirst: this.curThirst,\n          hunger: this.curHunger,\n          load: this.curLoad\n        });\n      }\n    }\n  }, {\n    key: \"checkForEndGame\",\n    value: function checkForEndGame() {\n      return this.state.hunger >= 100 || this.state.hunger <= 0 || this.state.thirst >= 100 || this.state.thirst <= 0 || this.state.load >= 100;\n    }\n  }, {\n    key: \"renderEndGame\",\n    value: function renderEndGame() {\n      if (!this.hasSentData) {\n        //TODO: Send Data to Server Here\n        this.hasSentData = true;\n      }\n\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193\n        },\n        __self: this\n      }, \"GAME OVER\");\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (this.checkForEndGame()) {\n        return this.renderEndGame();\n      }\n\n      console.log(this.state.tick);\n      return React.createElement(\"div\", {\n        className: \"gameController\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 206\n        },\n        __self: this\n      }, React.createElement(Grid, {\n        gameGrid: this.state.currentGrid,\n        entities: this.state.entities,\n        playerX: this.state.playerXPos,\n        playerY: this.state.playerYPos,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207\n        },\n        __self: this\n      }), React.createElement(LifeBarController, {\n        hunger: this.state.hunger,\n        thirst: this.state.thirst,\n        load: this.state.load,\n        hungerRangeBottom: this.hungerLowerBound,\n        hungerRangeTop: this.hungerUpperBound,\n        thirstRangeBottom: this.thirstLowerBound,\n        thirstRangeTop: this.thirstUpperBound,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 212\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return GameController;\n}(Component);\n\nexport default GameController;","map":{"version":3,"sources":["/Users/yashshetty/Desktop/Sandbox/allostasis-game/src/GameController.js"],"names":["React","Component","Grid","ConfigurableValuesController","GlobalConstants","LifeBarController","ServerUtils","ENTER_KEY","LEFT_KEY","UP_KEY","RIGHT_KEY","DOWN_KEY","GRID_LENGTH","getGridRowLength","GameController","_handleKeyDown","event","keyCode","console","log","_handlePlayerMovement","hasSentData","curThirst","getInitialThirst","curHunger","getInitialHunger","curLoad","getInitialLoad","hungerLowerBound","getHungerLowerBound","hungerUpperBound","getHungerUpperBound","thirstLowerBound","getThirstLowerBound","thirstUpperBound","getThirstUpperBound","tick","state","entities","_generateEntities","playerXPos","getInitialXPos","playerYPos","getInitialYPos","hunger","thirst","load","_placeEntity","getEntityDataWater1","getEntityDataWater2","getEntityDataFood1","getEntityDataFood2","new_entity_data","random_coord","Math","max","min","round","random","no_placement_conflict","entity","x","y","push","data","every","document","addEventListener","bind","removeEventListener","num","temp","interval","setInterval","setState","xMov","yMov","curX","curY","entitiesHere","filter","e","entityRewards","reduce","total","rewards","reward_fn","food","water","getMovementHungerDecay","getMovementThirstDecay","_adjustThirst","_adjustHunger","_adjustLoad","checkForEndGame","renderEndGame","currentGrid"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport Grid from './Grid/Grid.js'\nimport ConfigurableValuesController from './ConfigurableValuesController.js';\nimport GlobalConstants from './GlobalConstants.js';\nimport LifeBarController from './LifeBars/LifeBarController.js';\nimport ServerUtils from './ServerUtils';\nimport \"./GameController.css\";\n\nconst ENTER_KEY = 13;\nconst LEFT_KEY = 37;\nconst UP_KEY = 38;\nconst RIGHT_KEY = 39;\nconst DOWN_KEY = 40;\n\nconst GRID_LENGTH = ConfigurableValuesController.getGridRowLength();\n\nclass GameController extends Component { \n\n  constructor() {\n    super();\n    this.hasSentData = false;\n    this.curThirst = ConfigurableValuesController.getInitialThirst();\n    this.curHunger = ConfigurableValuesController.getInitialHunger();\n    this.curLoad = ConfigurableValuesController.getInitialLoad();\n    this.hungerLowerBound = ConfigurableValuesController.getHungerLowerBound();\n    this.hungerUpperBound = ConfigurableValuesController.getHungerUpperBound();\n    this.thirstLowerBound = ConfigurableValuesController.getThirstLowerBound();\n    this.thirstUpperBound = ConfigurableValuesController.getThirstUpperBound();\n    this.tick = 0;\n\n    this.state = {\n      entities: this._generateEntities(),\n      playerXPos: ConfigurableValuesController.getInitialXPos(),\n      playerYPos: ConfigurableValuesController.getInitialYPos(),\n      hunger: this.curHunger,\n      thirst: this.curThirst,\n      load: this.curLoad\n    }\n  }\n\n  _generateEntities() {\n    let entities = [];\n    this._placeEntity(entities, ConfigurableValuesController.getEntityDataWater1());\n    this._placeEntity(entities, ConfigurableValuesController.getEntityDataWater2());\n    this._placeEntity(entities, ConfigurableValuesController.getEntityDataFood1());\n    this._placeEntity(entities, ConfigurableValuesController.getEntityDataFood2());\n    return entities;\n  }\n\n  // Creates a new entity with the specified data and random coordinates,\n  // placing it into the array `entities`\n  _placeEntity(entities, new_entity_data) {\n    let random_coord = () => {\n      return Math.max(Math.min(Math.round(Math.random() * GRID_LENGTH), GRID_LENGTH - 1), 0);\n    };\n    let no_placement_conflict = entity => {\n      return x !== entity.x && y !== entity.y;\n    }\n\n    do {\n      var x = random_coord();\n      var y = random_coord();\n      entities.push({x, y, data: new_entity_data});\n    } while(entities.every(no_placement_conflict));\n  }\n  \n  componentWillMount(){\n    document.addEventListener(\"keydown\", this._handleKeyDown.bind(this));\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener(\"keydown\", this._handleKeyDown.bind(this));\n  }\n\n  _handleKeyDown = (event) => {\n    switch( event.keyCode ) {\n        case ENTER_KEY:\n            console.log(\"ENTER\");\n            break;\n        case LEFT_KEY:\n            this._handlePlayerMovement(-1, 0);\n            break;  \n        case UP_KEY:\n            this._handlePlayerMovement(0, -1);\n            break;\n        case RIGHT_KEY:\n            this._handlePlayerMovement(1, 0);\n            break;\n        case DOWN_KEY:\n            this._handlePlayerMovement(0, 1);\n            break;    \n        default: \n            break;\n    }\n  }\n\n  _adjustThirst(num) {\n    let temp = this.curThirst;\n    temp += num\n    if (temp >= 0) {\n      if (temp > 100) {\n        this.curThirst = 100;\n      } else {\n        this.curThirst = temp;\n      }\n    } else {\n      this.curThirst = 0;\n    }\n  }\n\n  _adjustHunger(num) {\n    let temp = this.curHunger;\n    temp += num\n    if (temp >= 0) {\n      if (temp > 100) {\n        this.curHunger = 100;\n      } else {\n        this.curHunger = temp;\n      }\n    } else {\n      this.curHunger = 0;\n    }\n  }\n\n  _adjustLoad(num) {\n    let temp = this.curLoad;\n    temp += num\n    if (temp >= 0) {\n      if (temp > 100) {\n        this.curLoad = 100;\n      } else {\n        this.curLoad = temp;\n      }\n    } else {\n      this.curLoad = 0;\n    }\n  }\n\n  componentDidMount() {\n    this.interval = setInterval(this.tick, 1000);\n  }\n\n  tick() {\n    this.setState({\n      tick: this.state.tick + 1\n    });\n  }\n\n  _handlePlayerMovement(xMov, yMov) {\n    let curX = this.state.playerXPos;\n    let curY = this.state.playerYPos;\n    curX += xMov;\n    curY += yMov;\n\n    if (curX >= 0 && curX < ConfigurableValuesController.getGridRowLength() \n        && curY >= 0 && curY < ConfigurableValuesController.getGridRowLength()) {\n      let entitiesHere = this.state.entities.filter(e => e.x === curX && e.y === curY);\n      let entityRewards = entitiesHere.reduce((total, e) => {\n        let rewards = e.data.reward_fn();\n        return {\n          food: total.food + rewards.food,\n          water: total.water + rewards.water,\n        }\n      }, {\n        food: ConfigurableValuesController.getMovementHungerDecay(),\n        water: ConfigurableValuesController.getMovementThirstDecay(),\n      });\n\n      this._adjustThirst(entityRewards.water);\n      this._adjustHunger(entityRewards.food);\n      this._adjustLoad(1);\n      this.setState({\n        playerXPos: curX,\n        playerYPos: curY,\n        thirst: this.curThirst,\n        hunger: this.curHunger,\n        load: this.curLoad\n      });\n    }\n    \n  }\n\n  checkForEndGame() {\n    return this.state.hunger >= 100 || this.state.hunger <= 0 || this.state.thirst >= 100 || this.state.thirst <=0 || this.state.load >= 100;\n  }\n\n  renderEndGame() {\n    if (!this.hasSentData) {\n      //TODO: Send Data to Server Here\n      this.hasSentData = true;\n    }\n    return (\n        <div>\n          GAME OVER\n        </div>\n\n      );\n  }\n\n  render() {\n    if (this.checkForEndGame()) {\n      return this.renderEndGame();\n    }\n    console.log(this.state.tick);\n    return (\n      <div className=\"gameController\">\n        <Grid\n          gameGrid = {this.state.currentGrid}\n          entities = {this.state.entities}\n          playerX = {this.state.playerXPos}\n          playerY = {this.state.playerYPos}/>\n        <LifeBarController\n          hunger={this.state.hunger}\n          thirst={this.state.thirst}\n          load={this.state.load}\n          hungerRangeBottom={this.hungerLowerBound}\n          hungerRangeTop={this.hungerUpperBound}\n          thirstRangeBottom={this.thirstLowerBound}\n          thirstRangeTop={this.thirstUpperBound}/>\n      </div>\n    );\n  }\n}\n\nexport default GameController;\n"]},"metadata":{},"sourceType":"module"}